language: android
dist: trusty
jdk: oraclejdk8
env:
  global:
  - ANDROID_API=29
android:
  components:
  # - tools
  # - tools
  # - platform-tools
  - build-tools-29.0.3
  - android-${ANDROID_API}
  - extra-android-m2repository
  licenses:
  - android-sdk-license-.+
before_install:
- yes | sdkmanager "platforms;android-${ANDROID_API}"
before_cache: "-rm -f $HOME/.gradle/caches/modules-2/modules-2.lock -rm -fr $HOME/.gradle/caches/*/plugin-resolution/"
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.android/build-cache"
script:
- "./gradlew assembleRelease"
deploy:
  provider: releases
  api_key:
    secure: ZSguQ3YOds6kSaaQ907Ma8pl0R0oLHod12jGLFHtbufZnQYNXTu7EYdimeI8MJ+uf8dOzjNvvyN0fJcwxCEkSLhhbBsCm5Is4x1Afbp2AwFif6rES1XRnsBPWBuLvCroWnA0iVu0pgGKtcrmakmLtKPuy18IRbGfHYojortAQ1C+UPvREHskmIIcO/+pNnQEO6d33WZcCnpQQCUc3E0AQrjm4FejKqeVrXMj5IXxzJ0+okb/zE/dX/lgPufk2b794LD6v9FtUNG1myqk+9akht1e1A/UhsshwuZS/mtPCv2UEdQXBxaPyn5KD/MpPxx5b6DErxlr6wyfpFJg6A+jq3Zm2MDZP2OJyJM9C7zJdDNm9OL2FUg+5vOB+oNdZeg/vrRMQ10JAcAbil0ox31YWlalsUrMu8uNA8grx9IeNw6ZP8GM8cNOEnuFAen68xia/Ho7CVH3zS8teNR83eCS9IYqVFNu31ZuF+67EiN06jtiQHnw/vSmnYedOcIc7rApgm/fdxqUvS9ZHgoNFgtTq51SD4qFh4IDT3Ort8hXIlwZrZ1gQBZxzQK51JhbTzIVZ6pWtJYUjGGj4W0SJre3h237A3a+17IMwU2ZCZnnis9hnIfOgRhrqYFGGD7hqt8krvST6faSG+TkKG/IEa1ZXkfnz7aXD2C4PdyDAWRcWcg=
  file_glob: true
  file: "$TRAVIS_BUILD_DIR/app/build/outputs/apk/release/*.apk"
  on:
    repo: anode-co/AnodeVPN-android
    tags: true
  skip_cleanup: 'true'
after_deploy:
  - bash "$TRAVIS_BUILD_DIR/tools/release_notify.sh"
